<!doctype html>
<html>
    <head>
        <script type="text/javascript" src="/homey.js" data-origin="settings"></script>
    </head>

    <body>
    <h1 data-i18n="settings.title"></h1>
    <fieldset>
        <legend data-i18n="settings.timeouts.title"></legend>
        <div class="field row">
            <label for="measured_power_timeout" data-i18n="settings.timeouts.measured_power_timeout"></label>
            <input id="measured_power_timeout" type="text" value="" placeholder="1" />
        </div>
        <div class="field row">
            <label for="meter_power_timeout" data-i18n="settings.timeouts.meter_power_timeout"></label>
            <input id="meter_power_timeout" type="text" value="" placeholder="1" />
        </div>
    </fieldset>
    <button id="save" class="right" data-i18n="settings.save_changes"></button>

    <script type="text/javascript">
        function onHomeyReady( Homey ){
            Homey.ready();

            var measuredPowerTimeoutElement = document.getElementById('measured_power_timeout');
            var meterPowerTimeoutElement = document.getElementById('meter_power_timeout');
            var saveButtonElement = document.getElementById('save');

            Homey.get('measured_power_timeout', function( err, measuredPowerTimeout ) {
                if( err ) return Homey.alert( err );
                measuredPowerTimeoutElement.value = measuredPowerTimeout;
            });

            Homey.get('meter_power_timeout', function( err, meterPowerTimeout ) {
                if( err ) return Homey.alert( err );
                meterPowerTimeoutElement.value = meterPowerTimeout;
            });

            saveButtonElement.addEventListener('click', function(e) {

                Homey.set('measured_power_timeout', measuredPowerTimeoutElement.value, function( err ){
                    if( err ) return Homey.alert( err );
                });
                Homey.set('meter_power_timeout', meterPowerTimeoutElement.value, function( err ){
                    if( err ) return Homey.alert( err );
                });

            });
        }
    </script>
    </body>
</html>